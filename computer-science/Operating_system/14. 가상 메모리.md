---
tags:
  - operating_system
---
### 스와핑(swapping) 
메모리에서 사용되지 않는 일부 프로세스를 보조기억장치로 내보내고 실행할 프로세스를 메모리로 들여보내는 메모리 관리 기법이다.
![[os_virtual-memory_swappnig.png]]
프로세스들이 옮겨지는 보조기억장치의 일부 영역을 스왑 영역(swap space)라고 한다.
실행되지 않는 <span style="color:rgb(218, 195, 137)">프로세스가 메모리에서 스왑 영역으로 옮겨지는 것</span>을 스왑 아웃(swap-out)이라고 한다.
스왑 영역에 있던 <span style="color:rgb(218, 195, 137)">프로세스가 다시 메모리로 옮겨오는 것</span>을 스왑 인(swap-in)이라고 한다.

스와핑을 이용하면 프로세스들이 요구하는 메모리 주소 공간의 크기가 실제 메모리 크기보다 큰 경우에도 프로세스들을 동시 실행할 수 있다.
![[os_virtual-memory_swapping_2.png]]

> [!info]- 스왑 영역 확인하기
> 유닉스와 리눅스, macOS에서는 free, top 명령어 등을 통해 스왑 영역의 크기를 확인할 수 있다.
> 스왑 영역의 크기와 사용 여부는 사용자가 임의로 설정할 수 있다.

***
### 메모리 할당 방식
<span style="color:rgb(218, 195, 137)">프로세스에 연속적인 메모리 공간을 할당하는 방식</span>을 연속 메모리 할당 방식이라고 한다.

#### 최초 적합(first fit)
<span style="color:rgb(218, 195, 137)">최초로 발견한 적재 가능한 빈 공간</span>에 프로세스를 배치하는 방식이다.
검색을 최소화할 수 있고 결과적으로 빠른 할당이 가능하다.

#### 최적 적합(best fit)
프로세스가 <span style="color:rgb(218, 195, 137)">적재될 수 있는 공간 중 가장 작은 공간</span>에 프로세스를 배치하는 방식

#### 최악 적합(worst fit)
프로세스가 <span style="color:rgb(218, 195, 137)">적재될 수 있는 공간 중 가장 큰 공간</span>에 프로세스를 배치하는 방식

***
### 외부 단편화(external fragmentation)
<span style="color:rgb(218, 195, 137)">프로세스를 할당하기 어려울 만큼 작은 메모리 공간들로 인해 메모리가 낭비</span>되는 현상을 의미한다.

연속 메모리 할당은 메모리를 효율적으로 사용하는 방법은 아니다.
아래 그림의 왼쪽과 같은 상황에서 현재 메모리에 남아 있는 빈 공간의 총합은 50MB라고 할 수 있다.
그러나 빈 공간의 총합은 50MB일지라도 어느 빈 공간에도 50MB 크기의 프로세스가 적재될 수 없다.
프로세스들이 메모리에 연속적으로 할당되는 환경에서는 프로세스들이 실행되고 종료되기를 반복하며 ==메모리 사이 사이에 빈 공간==들이 생긴다.
빈 공간이지만 그 ==공간보다 큰 프로세스를 적재하기 어려운 상황==을 초래하고, 결국 ==메모리 낭비==로 이어진다.

![[os_virtual-memory_external-fragmentation.png]]
외부 단편화를 해결할 수 있는 대표적인 방안으로 메모리를 압축(compaction)하는 방법이 있다.
메모리 내에 저장된 프로세스를 적당히 재배치시켜 여기저기 흩어져 있는 작은 빈 공간들을 하나의 큰 빈 공간으로 만드는 방법이다.
다만 작은 빈 공간들을 하나로 모으는 동안 ==시스템은 하던 일을 중지==해야 하고, 메모리에 있는 내용을 옮기는 작업은 ==많은 오버헤드를 야기==하며, 어떤 프로세스를 어떻게 움직여야 오버헤드를 최소화하며 압출할 수 있는지에 대한 명확한 방법을 결정하기 어렵다.

***
### 가상 메모리 관리
가상 메모리(virtual memory)는 <span style="color:rgb(218, 195, 137)">실행하고자 하는 프로그램을 일부만 메모리에 적재</span>하여 실제 물리 메모리 크기보다 더 큰 프로세스를 실행할 수 있게 하는 기술이다.

#### 페이징(paging)
<span style="color:rgb(218, 195, 137)">메모리의 물리 주소 공간을 프레임(frame)단위로 자르고, 프로세스의 논리 주소 공간을 페이지(page)단위로 자른 뒤 각 페이지를 프레임에 할당</span>하는 가상 메모리 관리 기법이다.
즉, 프로세스를 일정한 단위로 자르고, 이를 메모리에 불연속적으로 할당하면서 외부 단편화가 발생하지 않는다.

페이징에서도 스와핑을 사용할 수 있는데, 페이지 단위로 스왑 아웃/스왑 인된다.
페이징 시스템에서의 스왑 아웃은 페이지 아웃(page out), 스왑 인은 페이지 인(page in)이라고 부른다.
즉, 한 프로세스를 실행하기 위해 ==프로세스 전체가 메모리에 적재될 필요가 없다==는 것과 같다.
실행에 필요한 일부 페이지만을 메모리에 적재하고, 당장 실행에 필요하지 않는 페이지들은 보조기억장치에 남겨둘 수 있다.

##### 페이지 테이블(page table)
프로세스가 메모리에 불연속적으로 배치되면 CPU 입장에서 다음에 실행할 명령어 위치를 찾기가 어려워진다.
프로세스가 비록 물리 주소에 불연속적으로 배치되더라도 논리 주소에는 연속적으로 배치되도록 페이지 테이블을 이용한다.
페이지 테이블은 <span style="color:rgb(218, 195, 137)">페이지 번호와 프레임 번호를 연결</span>해주는 표이다. ==현재 어떤 페이지가 어떤 프레임에 할당되었는지==를 알려준다.

CPU는 논리 주소를 그저 순차적으로 실행하면 된다.
